<div class="organizar-container">
  <header class="organizar-header">
    <div class="header-left">
      <app-volver></app-volver>
      <h2>Subastas Aceptadas</h2>
      <span class="evento-id">Listado general</span>
    </div>
    <button class="btn-secundario" (click)="Generar()" [disabled]="generando">
      {{ generando ? 'Generando...' : 'Generar subastas' }}
    </button>
  </header>

  <div class="lista-subastas">

    <p *ngIf="cargando" class="estado-lista">
      Cargando subastas aceptadas...
    </p>

    <div class="fila-subasta" *ngFor="let s of subastas">
      <!-- Usamos método zoom(s) en lugar de asignar directamente -->
      <label class="img-box" (click)="zoom(s)">
        <span class="badge-numero">#{{ s.numeroSubasta || '-' }}</span>
        <img *ngIf="getImagenSrc(s); else noImg" [src]="getImagenSrc(s)">
        <ng-template #noImg>
          <div class="img-empty">Sin imagen</div>
        </ng-template>
      </label>

      <div class="info">
        <h3 class="planta">{{ s.planta }}</h3>
        <div class="precio-row">
          <span class="precio">S/ {{ s.precioBase }}</span>
          <span class="estado estado-aceptado">ACEPTADA</span>
        </div>
        <p class="sub">Subastador: <b>{{ s.username }}</b></p>
      </div>

      <div class="acciones">
        <button class="btn-detalle primary" (click)="s.showModal = true">
          Ver detalle
        </button>
        <button *ngIf="s.numeroSubasta" class="btn-whatsapp" (click)="copiarSubasta(s)">
          Copiar
        </button>
      </div>

      <div class="modal" *ngIf="s.showModal">
        <div class="modal-bg" (click)="s.showModal = false"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h3>{{ s.planta }}</h3>
            <button class="modal-close" (click)="s.showModal = false">×</button>
          </div>
          <div class="modal-body">
            <p><b>N° Subasta:</b> {{ s.numeroSubasta || '-' }}</p>
            <p><b>Fecha:</b> {{ s.fechaEvento | date:'dd/MM/yyyy' }}</p>
            <p><b>Hora:</b> {{ s.horaInicioAsignada || '-' }} - {{ s.horaFinAsignada || '-' }}</p>
            <p><b>Duración:</b> {{ s.duracionSubastaMinutos }} min</p>
            <p><b>Contacto:</b> {{ s.username }}</p>
            <p><b>Ciudad:</b> {{ s.city }}</p>
            <p><b>Teléfono:</b> {{ s.phone }}</p>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!cargando && !subastas.length" class="estado-lista">
      <p>No hay subastas aceptadas</p>
    </div>
  </div>

  <div class="zoom-image" *ngIf="showZoom" (click)="showZoom = false">
    <div class="zoom-image-bg"></div>
    <img [src]="zoomSrc" (click)="$event.stopPropagation()">
    <button class="zoom-close">×</button>
  </div>
</div>
