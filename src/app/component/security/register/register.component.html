<div class="register-wrapper">
  <h2>Registro</h2>

  <form [formGroup]="form" (ngSubmit)="registrar()" class="register-form">
    <div class="form-group">
      <label>Correo Electrónico</label>
      <input type="email" formControlName="username" placeholder="usuario@correo.com" autocomplete="email">
      <small *ngIf="form.get('username')?.touched && form.get('username')?.invalid">Ingresa un correo válido</small>
    </div>

    <div class="form-group">
      <label>Confirmar Correo Electrónico</label>
      <input type="email" formControlName="confirmEmail" placeholder="Repite tu correo" autocomplete="email">
      <small *ngIf="form.get('confirmEmail')?.touched && form.errors?.['emailMismatch']">Los correos no coinciden</small>
    </div>

    <div class="form-group">
      <label>Contraseña</label>
      <div class="password-wrapper">
        <input [type]="passwordVisible ? 'text' : 'password'" formControlName="password" placeholder="Contraseña" autocomplete="new-password">
        <button type="button" class="toggle-btn" (click)="togglePassword()">{{ passwordVisible ? 'Ocultar' : 'Mostrar' }}</button>
      </div>
      <small *ngIf="form.get('password')?.touched && form.get('password')?.invalid">La contraseña debe tener al menos 5 caracteres</small>
    </div>

    <div class="form-group">
      <label>Confirmar Contraseña</label>
      <input [type]="passwordVisible ? 'text' : 'password'" formControlName="confirmPassword" placeholder="Repite la contraseña" autocomplete="new-password">
      <small *ngIf="form.get('confirmPassword')?.touched && form.errors?.['passwordMismatch']">Las contraseñas no coinciden</small>
    </div>

    <div class="form-group">
      <label>Nombre</label>
      <input type="text" formControlName="name" placeholder="Nombre" autocomplete="given-name">
    </div>

    <div class="form-group">
      <label>Apellido</label>
      <input type="text" formControlName="lastName" placeholder="Apellido" autocomplete="family-name">
    </div>

    <div class="form-group">
      <label>País</label>
      <select formControlName="country" (change)="onCountryChange()">
        <option value="" disabled selected>Selecciona tu país</option>
        <option *ngFor="let c of countries" [value]="c.name">{{ c.name }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Departamento</label>
      <select formControlName="department" (change)="onDepartmentChange()">
        <option value="" disabled selected>Selecciona tu departamento</option>
        <option *ngFor="let d of selectedRegions" [value]="d.name">{{ d.name }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Ciudad (opcional)</label>
      <select formControlName="city">
        <option value="" selected>Selecciona tu ciudad</option>
        <option *ngFor="let city of selectedCities" [value]="city">{{ city }}</option>
      </select>
    </div>

    <div class="form-group">
      <label>Teléfono</label>
      <div class="phone-wrapper">
        <span class="country-code">+{{ countryCode }}</span>
        <input type="text" formControlName="phone" placeholder="999999999" autocomplete="tel">
      </div>
      <small *ngIf="form.get('phone')?.touched && form.get('phone')?.invalid">Ingresa un teléfono válido</small>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" formControlName="acceptTerms">
        Acepto los <a [routerLink]="['/terminos']" target="_blank">Términos y Condiciones</a>
      </label>
      <small *ngIf="form.get('acceptTerms')?.touched && form.get('acceptTerms')?.invalid">
        Debes aceptar los términos para registrarte
      </small>
    </div>

    <div class="btn-group">
      <button type="submit" [disabled]="loading || !form.get('acceptTerms')?.value" class="btn-submit">
        {{ loading ? 'Registrando...' : 'Registrar' }}
      </button>
      <button type="button" class="btn-cancel" (click)="cancelarRegistro()" *ngIf="!loading">Cancelar</button>
    </div>
  </form>

  <div *ngIf="successMessage" class="success-message">✅ {{ successMessage }}</div>
  <div *ngIf="errorMessage" class="error-message">❌ {{ errorMessage }}</div>
</div>
